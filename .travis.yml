language: python
python:
- 3.6

service: docker

git:
  depth: false
  quiet: true

notifications:
  email:
  recipients:
    - tomas.forne-cappeau@epitech.eu
  on_success: never
  on_failure: always

jobs:
  include:
    - stage: Build
      name: "Building image"
      script: make build
    - stage: Tests
      name: "Adding files"
      script:
        - make
        - chmod +x ./ci/test_add.sh
        - ./ci/test_add.sh
    -
      name: "Removing files"
      script:
        - make
        - chmod +x ./ci/test_remove.sh
        - ./ci/test_remove.sh
    -
      name: "Moving files"
      script:
        - make
        - chmod +x ./ci/test_remove.sh
        - ./ci/test_move.sh
    -
      name: "All tests with the same environment"
      script:
        - make tests_run
    - stage: Deployment
      name: "Push to docker hub"
      script:
        - docker build . -t makefile_completer
        - docker push colcolt/makefile_completer:latest

stages:
- Build
- Tests
- name: Deployment
  if: branch IN (master) AND type != cron AND type != pull_request

env:
  global:
    secure: Z/7Iv2cNGxCZBdHPos+CSvjkk92ru4dCSynHT50SuYJAi58IZOg/WcbjEKzSwMylpi+1SJqLXAoF7ugutTcW+XAmlbPUei+T6KFHmWsNcgZeUM2dmWQy6OI7UX3drBmBGIa50YUwNmay1QdsTMGeN5QiqebNs1FBdMyAk8zHRLqBBxO2M82rcE/KhRElSMghGdOlec2BJQp13I2dS+uodr5DB68Dr9k4nAFWlHjNwLjWQo5TJZzpYut2eJcmSHMOkEXzTiFyXyw/bW9VUrO2AfUtEnqFOD8m/vpBWS5l9JeuL+m8wLUjjr6REU+R7dlzTo+n6eVSo998iOlpusaiNvjYdE2Na6KodBZjm7V0/JLlF2GJLO/6Ht/K5L7fPAftFjrmylGsyiuYJy+xp7s5NYuRy4229z7hsK2/pNt563zG5ZnPcoe/BQLGEAXjrbgcsvn/pEqZHMDt4UhhmF31q7IWe+16wT8OQSmsuEmz1EQ1QiRAkcTbcWotgcyE/oxLujP37KRNU/qBZ4lpAxPol7mgtsAb0hOkuPLI/FXO4xzjPbAnK8+1DcvSO2uLi6l53ZR/wfKr4ASKt/6CRXMiXus8GEbLgXj8JnOiPJOzb/tbEkcWfcVc07w3ldoMgP4peYYgEw6mKXAqut1uQJwPGVcP+q0Cx2Q9M/knB4ud2w8=